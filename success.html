<!DOCTYPE html>
<html>
<head>
  <title>인증 완료</title>
  <script src="config.js"></script>
  <script>
    // URL에서 인증 토큰을 확인합니다.
    const url = new URL(window.location.href);
    const params = new URLSearchParams(url.search);
    const code = params.get('code'); // ✅ code 파라미터 가져오기

    if (code) {
      // ✅ PKCE 코드를 세션 토큰으로 교환하는 로직 추가
      const supabase = window.supabase.createClient(
        SUPABASE_URL, // ✅ 여기에 Supabase URL
        SUPABASE_ANON_KEY
      );

      supabase.auth.exchangeCodeForSession(code).then(({ data, error }) => {
        if (error) {
          alert('인증 실패');
          window.close();
        } else {
          // ✅ 성공적으로 세션을 얻으면 알림을 띄웁니다.
          alert('메일 인증이 완료되었습니다!');
          window.close();
        }
      });
    } else {
      alert('인증 실패');
      window.close();
    }
  </script>
</head>
<body>
  <h1>인증이 완료되었습니다!</h1>
  <p>창을 닫고 앱으로 돌아가 로그인해주세요.</p>
</body>
</html>
